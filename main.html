<script>
  const textArea = document.getElementById("text");
  const voiceSelect = document.getElementById("voice");
  const rate = document.getElementById("rate");
  const pitch = document.getElementById("pitch");
  const speakBtn = document.getElementById("speak");
  const stopBtn = document.getElementById("stop");

  let voices = [];

  function loadVoices() {
    voices = speechSynthesis.getVoices();
    voiceSelect.innerHTML = "";

    voices.forEach((voice, index) => {
      const option = document.createElement("option");
      option.value = index;
      option.textContent = voice.name;
      voiceSelect.appendChild(option);
    });
  }

  speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  speakBtn.addEventListener("click", () => {
    const text = textArea.value;
    if (!text) return;

    speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.voice = voices[voiceSelect.value];
    utterance.rate = rate.value;
    utterance.pitch = pitch.value;

    speechSynthesis.speak(utterance);
  });

  stopBtn.addEventListener("click", () => {
    speechSynthesis.cancel();
  });

  voiceSelect.addEventListener("change", () => {
    if (speechSynthesis.speaking) speakBtn.click();
  });

  rate.addEventListener("input", () => {
    if (speechSynthesis.speaking) speakBtn.click();
  });

  pitch.addEventListener("input", () => {
    if (speechSynthesis.speaking) speakBtn.click();
  });
</script>
