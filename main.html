<script>
  // Required Elements (IDs must match exactly)
  const text = document.getElementById("text");
  const voice = document.getElementById("voice");
  const rate = document.getElementById("rate");
  const pitch = document.getElementById("pitch");
  const speak = document.getElementById("speak");
  const stop = document.getElementById("stop");

  let voices = [];
  let utterance = null;

  // Load voices
  function loadVoices() {
    voices = window.speechSynthesis.getVoices();
    voice.innerHTML = "";

    if (voices.length === 0) return;

    voices.forEach((v, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = v.name;
      voice.appendChild(option);
    });
  }

  window.speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  // Speak button
  speak.addEventListener("click", function () {
    if (!text.value) return;

    window.speechSynthesis.cancel();

    utterance = new SpeechSynthesisUtterance(text.value);
    utterance.voice = voices[voice.value];
    utterance.rate = rate.value;
    utterance.pitch = pitch.value;

    window.speechSynthesis.speak(utterance);
  });

  // Stop button
  stop.addEventListener("click", function () {
    window.speechSynthesis.cancel();
  });

  // Restart speech on change
  voice.addEventListener("change", function () {
    if (window.speechSynthesis.speaking) speak.click();
  });

  rate.addEventListener("input", function () {
    if (window.speechSynthesis.speaking) speak.click();
  });

  pitch.addEventListener("input", function () {
    if (window.speechSynthesis.speaking) speak.click();
  });
</script>
