<script>
  document.addEventListener("DOMContentLoaded", function () {

    const text = document.getElementById("text");
    const voice = document.getElementById("voice");
    const rate = document.getElementById("rate");
    const pitch = document.getElementById("pitch");
    const speak = document.getElementById("speak");
    const stop = document.getElementById("stop");

    if (!text || !voice || !rate || !pitch || !speak || !stop) return;

    let voices = [];

    function loadVoices() {
      voices = speechSynthesis.getVoices();
      voice.innerHTML = "";
      voices.forEach((v, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = v.name;
        voice.appendChild(opt);
      });
    }

    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    speak.addEventListener("click", function () {
      if (!text.value) return;

      speechSynthesis.cancel();

      const utterance = new SpeechSynthesisUtterance(text.value);
      utterance.voice = voices[voice.value];
      utterance.rate = rate.value;
      utterance.pitch = pitch.value;

      speechSynthesis.speak(utterance);
    });

    stop.addEventListener("click", function () {
      speechSynthesis.cancel();
    });

    voice.addEventListener("change", () => {
      if (speechSynthesis.speaking) speak.click();
    });

    rate.addEventListener("input", () => {
      if (speechSynthesis.speaking) speak.click();
    });

    pitch.addEventListener("input", () => {
      if (speechSynthesis.speaking) speak.click();
    });

  });
</script>
